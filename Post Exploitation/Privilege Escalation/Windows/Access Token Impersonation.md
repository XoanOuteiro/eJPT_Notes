
A windows access token is responsible for identifying and describing the security context of a process or thread running on a system

They are generated by the winlogon.exe every time a user authenticates succesfully.

They are categorized varying in security levels:

- Impersonate-Level token: Created as a direct result of a non-interactive login on Windows typically through specfific system services or domain logons.
- Delegate-Level token: Typically created through an interactive login on Windows, primarily through a traditional login or through remote access protocols such as RDP.


Windows Privileges are assigned to users and they dictate what user can and cannot do, token impersonation is used to elevate privileges.

In orther for you to be able to conduct an impersonation attack you will require at least one of the following:

- SeAssignPrimaryToken: Allows a user to impersonate tokens.
- SeCreateToken: Allows a user to create an arbitrary token with administrative privileges.
- SeImpersonatePrivilege: Allows a user to create a process under the security context of another user, typically with administrative privileges.

We will require a [[Metasploit]] meterpreter session (making this [[Privilege Escalation]], we will be using a module named Incognito:

We should use

``` bash
getprivs
```

To check for any of the needed tokens, this is an example fot the SeImpersonatePrivilege case:

``` bash
load incognito
list_tokens -u
```

Then we can copy the Delegation-Level token name of administrator and use

``` bash
impersonate_token "[token_name]"
```

Now with

``` bash
getuid
```

We may see we are administrator (Note: in case of permission uses check if we are under x64/x32 or x86 and migrate accordingly)

---

Under  a situation where we dont have any useful tokens on the base user we will need to conduct a potato attack

https://jlajara.gitlab.io/Potatoes_Windows_Privesc